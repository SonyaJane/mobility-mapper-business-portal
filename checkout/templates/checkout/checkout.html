{% extends "base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'checkout/css/checkout.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <h2 class="my-4">Complete your Purchase</h2>

  {% if form.errors %}
    <div class="alert alert-danger">
      <strong>Please correct the errors below:</strong>
      <ul>
        {% for field in form %}
          {% for error in field.errors %}
            <li>{{ error }}</li>
          {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <form action="" method="post" id="payment-form">
    {% csrf_token %}
    {% crispy form %}
    <!-- Stripe Card Element -->
    <div class="mb-3" id="card-element">
        <!-- A Stripe Card Element will be inserted here. -->
    </div>
    <!-- Display Card Errors -->
    <div id="card-errors" role="alert" class="text-danger mb-3"></div>
    <!-- Submit & Loading -->
    <button id="submit-button" type="submit" class="btn btn-primary">Pay</button>
    <div id="loading-overlay" class="d-none">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </form>
</div>
{% endblock %}

{% block postloadjs %}
    {{ block.super }}
    {{ stripe_publishable_key|json_script:"id_stripe_public_key" }}
    {{ client_secret|json_script:"id_client_secret" }}
    <script src="{% static 'js/checkout.js' %}"></script>
{% endblock %}
