{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container">
  <h2 class="my-4">Complete your Purchase</h2>

  {% if form.errors %}
    <div class="alert alert-danger">
      <strong>Please correct the errors below:</strong>
      <ul>
        {% for field in form %}
          {% for error in field.errors %}
            <li>{{ error }}</li>
          {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <form id="checkout-form" method="post">
    {% csrf_token %}
    {% crispy form %}
    <button type="submit" class="btn btn-primary">Proceed to Payment</button>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://js.stripe.com/basil/stripe.js"></script>
<script>
  // Configuration for checkout.js
  const stripePublishableKey = "{{ STRIPE_PUBLISHABLE_KEY }}";
  const createCheckoutSessionUrl = "{% url 'create_checkout_session' %}";
  const csrfToken = "{{ csrf_token }}";
</script>
<script src="{% static 'js/checkout.js' %}"></script>
{% endblock %}
