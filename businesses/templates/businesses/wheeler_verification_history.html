{% extends "base.html" %}
{% load dict_extras %}
{% block content %}
<div class="content-container m-1">
  <div class="p-2">
 
    <h5 class="my-4">Your Accessibility Verification History</h5>
    {% if requests %}
    <div class="table-responsive h-100 w-100" style="overflow:auto;">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Business</th>
            <th>Request Status</th>
            <th>Date Requested</th>
            <th>Date Request Approved</th>
            <th>Verification Report Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for req in requests %}
          <tr>
            <td>{{ req.business.business_name }}</td>
            <td>
              {% if req.approved %}
                <span class="badge bg-success">Approved</span>
              {% elif req.reviewed %}
                <span class="badge bg-danger">Rejected</span>
              {% else %}
                <span class="badge bg-warning text-dark">Submitted</span>
              {% endif %}
            </td>
            <td>{{ req.requested_at|date:"F j, Y" }}</td>
            <td>
              {% if req.approved_at %}
                {{ req.approved_at|date:"F j, Y" }}
              {% else %}
                <span class="text-muted">Waiting for approval</span>
              {% endif %}
            </td>
            <td>
              {% with submitted=verification_status|get_item:req.id approved=verification_approved|get_item:req.id %}
                {% if req.approved and submitted and approved %}
                  <span class="badge bg-success">Approved</span>
                {% elif req.approved and submitted %}
                  <span class="badge bg-info">Submitted</span>
                {% elif req.approved %}
                  <span class="badge bg-secondary">Not Submitted</span>
                {% endif %}
              {% endwith %}
            </td>
            <td>
              {% with submitted=verification_status|get_item:req.id %}
                {% if submitted %}
                  <a href="{% url 'verification_report' verification_id_map|get_item:req.id %}" class="btn btn-sm btn-secondary">View Report</a>
                {% elif req.approved %}
                  <a href="{% url 'wheeler_verification_form' req.business.id %}" class="btn btn-sm btn-primary">Submit Verification</a>
                {% endif %}
              {% endwith %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="alert alert-info">You have not made any verification requests yet.</p>
  {% endif %}
  </div>
</div>
{% endblock %}
