{% extends "base.html" %}
{% load crispy_forms_tags %}

{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/wheeler_verification_form.css' %}">
{% endblock %}

{% block page_title %}Accessibility Verification{% endblock %}

{% block content %}
<div class="content-container p-2">

  <h4 class="my-3 text-center">
    <span class="d-block">Verification of the accessibility features of</span>
    <span class="fw-bold text-primary py-2 d-block">{{ business.business_name }}</span>
    <span class="d-block">by</span>
    <span class="fw-bold text-primary py-2 d-block">{{ request.user.get_full_name }}</span>
  </h4>

  <p><strong>Address:</strong> {{ business.address }}</p>

  <p>Please complete this form while visiting the business.</p>

  <p>Your responses will be anonymous and your identity will not be revealed to the business.</p>

  <form method="POST" enctype="multipart/form-data">
    {% if form.errors %}
      <div class="alert alert-danger">
        <strong>Please correct the errors below:</strong>
        <ul>
        {% for field in form %}
          {% for error in field.errors %}
            {% if field.name == 'categories' or field.name == 'accessibility_features' %}
              <li>
                <strong>{{ field.label }}</strong><br>
                {{ error }}
              </li>
            {% else %}
              <li><strong>{{ field.label }}:</strong> {{ error }}</li>
            {% endif %}
          {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
          <li>{{ error }}</li>
        {% endfor %}
        </ul>
      </div>
    {% endif %}
    
    {% csrf_token %}

    <div class="mb-3 border-custom">
      <label class="fw-bold p-2">
        Below is a list of accessibility features the business has specified are present on the premises. 
        Please tick all features you can confirm are present. 
        If you cannot see a particular feature, please ask a staff member to show you. 
        If they are unable to do so, please leave it unticked, and provide a brief explanation in the comments section at the end of the form.
      </label>
      <table class="table table-striped table-bordered m-0">
        <tbody>
          {% for checkbox in form.confirmed_features %}
          <tr>
            <td>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="{{ checkbox.name }}" value="{{ checkbox.choice_value }}" id="{{ checkbox.id_for_label }}" style="width:1.5rem; height:1.5rem;">
                <label class="form-check-label" for="{{ checkbox.id_for_label }}">{{ checkbox.choice_label }}</label>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mb-3 border-custom">
      <label class="fw-bold p-2">
        Below is a list of accessibility features the business has NOT specified are present on the premises.
        Please tick any additional features you found during your visit.
      </label>
      <table class="table table-striped table-bordered m-0">
        <tbody>
          {% for feature in form.fields.additional_features.queryset %}
            {% if feature not in form.fields.confirmed_features.queryset %}
            <tr>
              <td>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="additional_features" value="{{ feature.pk }}" id="addfeat{{ feature.pk }}" style="width:1.5rem; height:1.5rem;">
                  <label class="form-check-label" for="addfeat{{ feature.pk }}">{{ feature.name }}</label>
                </div>
              </td>
            </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mb-3 border-custom">
      <label class="fw-bold p-2">
        Select the mobility device you used during your visit:
      </label>
      <table class="table table-striped table-bordered m-0">
        <tbody>
          {% for code, device_label in request.user.userprofile.MOBILITY_DEVICE_CHOICES %}
          <tr>
            <td>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="mobility_device" value="{{ code }}" id="mobdev{{ code }}" style="width:1.5rem; height:1.5rem;">
                <label class="form-check-label" for="mobdev{{ code }}">{{ device_label }}</label>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mb-3 border-custom">
      <label class="fw-bold p-2">
        Upload a photo of each of the accessibility features you selected above.
      </label>
      <input type="file" name="photos" multiple class="form-control" />
    </div>

    <div class="mb-3 border-custom">
      <label class="fw-bold p-2">
        Please write a few sentences about your accessibility experience while visiting this business.
      </label>
      <div class="w-100">
        {{ form.comments }}
      </div>
    </div>
    
    <button type="submit" class="btn btn-success">Submit Verification</button>
  </form>
</div>
{% endblock %}
